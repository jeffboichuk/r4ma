<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="dataviz.html">
<link rel="next" href="datastructures.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Marketing Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="marketing.html"><a href="marketing.html"><i class="fa fa-check"></i><b>1</b> What is Marketing?</a></li>
<li class="chapter" data-level="2" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>2</b> Tools at your Disposal</a><ul>
<li class="chapter" data-level="2.1" data-path="tools.html"><a href="tools.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="tools.html"><a href="tools.html#software"><i class="fa fa-check"></i><b>2.2</b> Software</a></li>
<li class="chapter" data-level="2.3" data-path="tools.html"><a href="tools.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.3</b> Getting Started with R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>3</b> Data Visualizations</a><ul>
<li class="chapter" data-level="3.1" data-path="dataviz.html"><a href="dataviz.html#creating-a-canvas"><i class="fa fa-check"></i><b>3.1</b> Creating a Canvas</a></li>
<li class="chapter" data-level="3.2" data-path="dataviz.html"><a href="dataviz.html#adding-layers-of-geoms"><i class="fa fa-check"></i><b>3.2</b> Adding Layers of Geoms</a></li>
<li class="chapter" data-level="3.3" data-path="dataviz.html"><a href="dataviz.html#adding-labels-axes-and-legends"><i class="fa fa-check"></i><b>3.3</b> Adding Labels, Axes, and Legends</a></li>
<li class="chapter" data-level="3.4" data-path="dataviz.html"><a href="dataviz.html#faceting-data-by-group"><i class="fa fa-check"></i><b>3.4</b> Faceting Data by Group</a></li>
<li class="chapter" data-level="3.5" data-path="dataviz.html"><a href="dataviz.html#chart-types"><i class="fa fa-check"></i><b>3.5</b> Chart Types</a></li>
<li class="chapter" data-level="3.6" data-path="dataviz.html"><a href="dataviz.html#advanced-plotting"><i class="fa fa-check"></i><b>3.6</b> Advanced Plotting</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datatransformation.html"><a href="datatransformation.html"><i class="fa fa-check"></i><b>4</b> Preparing and Transforming Data</a><ul>
<li class="chapter" data-level="4.1" data-path="datatransformation.html"><a href="datatransformation.html#data-pipelines"><i class="fa fa-check"></i><b>4.1</b> Data Pipelines</a></li>
<li class="chapter" data-level="4.2" data-path="datatransformation.html"><a href="datatransformation.html#selecting"><i class="fa fa-check"></i><b>4.2</b> Selecting</a></li>
<li class="chapter" data-level="4.3" data-path="datatransformation.html"><a href="datatransformation.html#mutating"><i class="fa fa-check"></i><b>4.3</b> Mutating</a></li>
<li class="chapter" data-level="4.4" data-path="datatransformation.html"><a href="datatransformation.html#grouped-mutates"><i class="fa fa-check"></i><b>4.4</b> Grouped Mutates</a></li>
<li class="chapter" data-level="4.5" data-path="datatransformation.html"><a href="datatransformation.html#summarizing"><i class="fa fa-check"></i><b>4.5</b> Summarizing</a></li>
<li class="chapter" data-level="4.6" data-path="datatransformation.html"><a href="datatransformation.html#spread-and-gather"><i class="fa fa-check"></i><b>4.6</b> Spread and Gather</a></li>
<li class="chapter" data-level="4.7" data-path="datatransformation.html"><a href="datatransformation.html#functions"><i class="fa fa-check"></i><b>4.7</b> Functions</a></li>
<li class="chapter" data-level="4.8" data-path="datatransformation.html"><a href="datatransformation.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.8</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datastructures.html"><a href="datastructures.html"><i class="fa fa-check"></i><b>5</b> Data Structures</a><ul>
<li class="chapter" data-level="5.1" data-path="datastructures.html"><a href="datastructures.html#tidy-principles"><i class="fa fa-check"></i><b>5.1</b> Tidy Principles</a></li>
<li class="chapter" data-level="5.2" data-path="datastructures.html"><a href="datastructures.html#relational-data"><i class="fa fa-check"></i><b>5.2</b> Relational Data</a></li>
<li class="chapter" data-level="5.3" data-path="datastructures.html"><a href="datastructures.html#joins"><i class="fa fa-check"></i><b>5.3</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>6</b> Measures in Marketing</a><ul>
<li class="chapter" data-level="6.1" data-path="measures.html"><a href="measures.html#net-promoter-score"><i class="fa fa-check"></i><b>6.1</b> Net Promoter Score</a></li>
<li class="chapter" data-level="6.2" data-path="measures.html"><a href="measures.html#customer-lifetime-value"><i class="fa fa-check"></i><b>6.2</b> Customer Lifetime Value</a></li>
<li class="chapter" data-level="6.3" data-path="measures.html"><a href="measures.html#customer-satisfactioncustomer-delight"><i class="fa fa-check"></i><b>6.3</b> Customer Satisfaction/Customer Delight</a></li>
<li class="chapter" data-level="6.4" data-path="measures.html"><a href="measures.html#others-consult-ama-dictionary-for-more"><i class="fa fa-check"></i><b>6.4</b> Others? Consult AMA dictionary for more?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fieldexp.html"><a href="fieldexp.html"><i class="fa fa-check"></i><b>7</b> Conducting Marketing Field Experiment</a></li>
<li class="chapter" data-level="8" data-path="mix.html"><a href="mix.html"><i class="fa fa-check"></i><b>8</b> Understanding Marketing Mix</a></li>
<li class="chapter" data-level="9" data-path="trade.html"><a href="trade.html"><i class="fa fa-check"></i><b>9</b> Pricing and Merchandising</a></li>
<li class="chapter" data-level="10" data-path="machinelearning.html"><a href="machinelearning.html"><i class="fa fa-check"></i><b>10</b> Machine Learning in Marketing</a></li>
<li class="chapter" data-level="11" data-path="action.html"><a href="action.html"><i class="fa fa-check"></i><b>11</b> Moving from Data to Action</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datatransformation" class="section level1">
<h1><span class="header-section-number">4</span> Preparing and Transforming Data</h1>
<p>It is a common adage that data analysts spend 80% of their time cleaning data and only 20% on value-add analysis. In this chapter we will show the basics of transforming data with the tidyverse package <strong>dplyr</strong>. Using these functions are the best way to reduce the overall amount of time spent on data cleaning and to create reproducible workflows whenever you receive new data.</p>
<div id="data-pipelines" class="section level2">
<h2><span class="header-section-number">4.1</span> Data Pipelines</h2>
<p>Before diving into the functions designed to help you transform data, we must cover a perculiar looking operator, the pipe or <code>%&gt;%</code>. You will repeatedly see the pipe (<code>%&gt;%</code>) used in the code examples for this chapter and in other parts of the book. This operator takes output from the function on its left side and passes it onto the function on its right side. As an example we will look at the <code>select()</code> function. The first argument in the function is <code>.data</code>. Whenever you use the pipe operator it will pass that output into the function’s first argument, which in this case, is a <code>tbl_df</code>. This means that we must put a <code>tbl_df</code> object (a dataset) on the left side of the pipe operator and then the <code>select()</code> function on the right. The first argument is assumed to be the data, so the remaining argument inside the function, according to the documentation, should be one or more unquoted variable names or numbers representing the position of columns. If we put this together, the command looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Petal.Length, Sepal.Length, Species)
<span class="co">#&gt; # A tibble: 150 x 3</span>
<span class="co">#&gt;   Petal.Length Sepal.Length Species</span>
<span class="co">#&gt;          &lt;dbl&gt;        &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">#&gt; 1          1.4          5.1 setosa </span>
<span class="co">#&gt; 2          1.4          4.9 setosa </span>
<span class="co">#&gt; 3          1.3          4.7 setosa </span>
<span class="co">#&gt; 4          1.5          4.6 setosa </span>
<span class="co">#&gt; 5          1.4          5   setosa </span>
<span class="co">#&gt; 6          1.7          5.4 setosa </span>
<span class="co">#&gt; # ... with 144 more rows</span></code></pre></div>
<p>The pipe is the glue for putting together multiple data transformations into a sequence. The benefits to using the pipe are that it reduces the amount of code needed to perform a sequence of operations.</p>
</div>
<div id="selecting" class="section level2">
<h2><span class="header-section-number">4.2</span> Selecting</h2>
<p>It is common to have a dataset with more columns than you need or have helper columns that you’ve created but no longer need. In the section above we demonstrated how to use the <code>select()</code> function with the pipe operator to pull out only the columns you want to work with. The select function has the nice feature of also being able to rename columns as you select them. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">petal_length=</span>Petal.Length, <span class="dt">sepal_lenth=</span>Sepal.Length, Species)
<span class="co">#&gt; # A tibble: 150 x 3</span>
<span class="co">#&gt;   petal_length sepal_lenth Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">#&gt; 1          1.4         5.1 setosa </span>
<span class="co">#&gt; 2          1.4         4.9 setosa </span>
<span class="co">#&gt; 3          1.3         4.7 setosa </span>
<span class="co">#&gt; 4          1.5         4.6 setosa </span>
<span class="co">#&gt; 5          1.4         5   setosa </span>
<span class="co">#&gt; 6          1.7         5.4 setosa </span>
<span class="co">#&gt; # ... with 144 more rows</span></code></pre></div>
<p>There is another function in <strong>dplyr</strong> called <code>rename()</code>, however, this can conflict with a function in the <strong>plyr</strong> package also named <code>rename()</code> if you have both packages loaded at the same time. To avoid confusion about which function to use you can reference the function you want using the package name and a double colon before the function like so, <code>dplyr::rename()</code>. This notation specifies the function and where to retrieve its definition, in this case, the <strong>dplyr</strong> package. If you would like to avoid this package function conflict, using just the <code>select()</code> function will help you accomplish everything and a little bit more than what the <code>rename()</code> function can do. The <code>rename()</code> function keeps all variables if you specify just one, then it will rename that one variable. By default, the <code>select()</code> function drops all other variables not specified, but you can work around this by supplying the <code>everything()</code> function into <code>select()</code>. The <code>everything()</code> select helper is not the only one. There are helper functions that match columns by name, numerical range, prefix, suffix and more. In the example below we are renaming the ID column, then pulling any of columns with “var” in the name, then everything else.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">flower=</span>Species, <span class="kw">contains</span>(<span class="st">&quot;Petal&quot;</span>), <span class="kw">everything</span>())
<span class="co">#&gt; # A tibble: 150 x 5</span>
<span class="co">#&gt;   flower Petal.Length Petal.Width Sepal.Length Sepal.Width</span>
<span class="co">#&gt;   &lt;fct&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 setosa          1.4         0.2          5.1         3.5</span>
<span class="co">#&gt; 2 setosa          1.4         0.2          4.9         3  </span>
<span class="co">#&gt; 3 setosa          1.3         0.2          4.7         3.2</span>
<span class="co">#&gt; 4 setosa          1.5         0.2          4.6         3.1</span>
<span class="co">#&gt; 5 setosa          1.4         0.2          5           3.6</span>
<span class="co">#&gt; 6 setosa          1.7         0.4          5.4         3.9</span>
<span class="co">#&gt; # ... with 144 more rows</span></code></pre></div>
<p><strong>FIND EXAMPLE THAT MATCHES TEXT ABOVE IT</strong></p>
<hr />
<p>SHOULD WE DISCUSS THE VARIANTS OF SELECT? The <code>select_helpers</code> make it convenient to specify many variables at once without having to type them all out individually.</p>
<hr />
</div>
<div id="mutating" class="section level2">
<h2><span class="header-section-number">4.3</span> Mutating</h2>
<p>Mutating a variable means changing a variable in place or creating a new variable. You can think of this as modifying the dataset you provide to the function and the variables of the dataset are the part that is changing or “mutating”. In the following example we’ll show in one step how to change an existing variable and create a new one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Species =</span> <span class="kw">paste</span>(Species, <span class="st">&quot;flower&quot;</span>), 
         <span class="dt">above_avg_sep_len =</span> (Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(iris<span class="op">$</span>Sepal.Length)))
<span class="co">#&gt; # A tibble: 150 x 6</span>
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2 setosa…</span>
<span class="co">#&gt; 2          4.9         3            1.4         0.2 setosa…</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2 setosa…</span>
<span class="co">#&gt; 4          4.6         3.1          1.5         0.2 setosa…</span>
<span class="co">#&gt; 5          5           3.6          1.4         0.2 setosa…</span>
<span class="co">#&gt; 6          5.4         3.9          1.7         0.4 setosa…</span>
<span class="co">#&gt; # ... with 144 more rows, and 1 more variable: above_avg_sep_len &lt;lgl&gt;</span></code></pre></div>
<p>If you are a frequent user of Excel, the <code>mutate()</code> function is how you can implement the logic of an <code>IF</code> statement. In the example below we create a 0/1 indicator variable based on another column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Species =</span> <span class="kw">paste</span>(Species, <span class="st">&quot;flower&quot;</span>), 
         <span class="dt">above_five_sep_len =</span> <span class="kw">ifelse</span>(Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))
<span class="co">#&gt; # A tibble: 150 x 6</span>
<span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1          5.1         3.5          1.4         0.2 setosa…</span>
<span class="co">#&gt; 2          4.9         3            1.4         0.2 setosa…</span>
<span class="co">#&gt; 3          4.7         3.2          1.3         0.2 setosa…</span>
<span class="co">#&gt; 4          4.6         3.1          1.5         0.2 setosa…</span>
<span class="co">#&gt; 5          5           3.6          1.4         0.2 setosa…</span>
<span class="co">#&gt; 6          5.4         3.9          1.7         0.4 setosa…</span>
<span class="co">#&gt; # ... with 144 more rows, and 1 more variable: above_five_sep_len &lt;dbl&gt;</span></code></pre></div>
<p>In Excel you would implement this as a formula <code>IF(A2 &gt; 5, 1, 0)</code> in Row 2 of a new blank column and drag the formula down.</p>
<p>Another common data transformation activity is recoding data. Instead of creating a series of nested <code>IF</code> statements in Excel or in R, you can leverage the <code>recode()</code> function inside of <code>mutate()</code>. In this example we are changing the survey response choice labels to numbers so that we can calculate summary statistics, like the mean and standard deviation of responses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mutate(response = recode(response, </span>
<span class="co">#                          `Strongly Agree` = 6, </span>
<span class="co">#                          `Agree` = 5, </span>
<span class="co">#                          `Slightly Agree` = 4,</span>
<span class="co">#                          `Slightly Disagree` = 3,</span>
<span class="co">#                          `Disagree` = 2,</span>
<span class="co">#                          `Strongly Disagree` = 1))</span></code></pre></div>
<p>If you have many survey questions on this scale and would like to them all in one pass, then you can implement with the <code>mutate_at()</code> function. It is an extension of the <code>mutate()</code> function that can apply your logic “at” multiple columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mutate_at(c(), funs(recode(., </span>
<span class="co">#                          `Strongly Agree` = 6, </span>
<span class="co">#                          `Agree` = 5, </span>
<span class="co">#                          `Slightly Agree` = 4,</span>
<span class="co">#                          `Slightly Disagree` = 3,</span>
<span class="co">#                          `Disagree` = 2,</span>
<span class="co">#                          `Strongly Disagree` = 1))</span></code></pre></div>
<hr />
<p>DECIDE IF WE HAVE AN EXAMPLE AND WANT TO SHOW MUTATE_IF()</p>
<hr />
<p>Aside from the <code>mutate_at()</code> function there is a <code>mutate_if()</code> function that will apply your logic “if” a column meets a certain criteria that you specify. This is a very handy function if, for example, you want to convert multiple columns that are character strings into integers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#mutate_if(is.character, as.numeric)</span></code></pre></div>
<hr />
</div>
<div id="grouped-mutates" class="section level2">
<h2><span class="header-section-number">4.4</span> Grouped Mutates</h2>
<p>A particularly challenging type of transformation in Excel is creating variables based on a group of records and applying it across all rows for the group. For example, calculating the difference between an individual’s maximum value compared to all other values. This requires finding the maximum for the group, then comparing it with each observation for the group. Typically, you might accomplish this through the creation of a Pivot Table and then using <code>VLOOKUP</code> to reference the maximum per individual. This gets unwieldly (sp) when then data changes. In R you can take the observations in a dataset and put them into groups based on a variable. In the example below, we have simply taken the dataset and modified it to remember that operations should be done in their respective group. Nothing has actually been changed on the data yet, but it is ready for an operation that acts upon the grouped data. The next step is to create that variable we mentioned above that represents the difference between the maximum value for the individual and each of their corresponding observations. In this example, we’ll also create another variable indicating <code>TRUE/FALSE</code> whether the row is the maximum to provide a visual cue and filtering mechanism to throw out those specific observations if desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dat %&gt;%</span>
<span class="co">#   group_by()</span></code></pre></div>
</div>
<div id="summarizing" class="section level2">
<h2><span class="header-section-number">4.5</span> Summarizing</h2>
<p>In the spirit of transforming data we will talk about summarizing it. A summary is just a transformation of underlying source data to a new form. Before summarizing data you must first have an idea about how to summarize it. Ask yourself: Do I want to count rows? Unique instances? Do I want to calculate the average? Standard deviation? Excel users often summarize using a Pivot Table which has the summarizing functions <code>COUNT</code>, <code>COUNTA</code>, <code>AVERAGE</code>, <code>STDEV</code>, <code>MAX</code>, and <code>MIN</code> to name a few. These are very similar to what exists in R and below is a table that translates each of these summary methods to their equivalent counterpart in R.</p>
<p>[INSERT TABLE HERE]</p>
<p>Below is an example in R of how to count the number of observations and compute the average.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">mean=</span><span class="kw">mean</span>(Petal.Length))
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       n  mean</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1   150  3.76</span></code></pre></div>
<p>If you would like to compute this same summary for different groups of the data then you can just add the <code>group_by()</code> function. As mentioned above, the <code>group_by()</code> function simply prepares the dataset so that it is segmented. Adding the <code>summarize()</code> function after the <code>group_by</code> means that the operations will be run separately across each of the data segments to compute one summary for each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">mean=</span><span class="kw">mean</span>(Petal.Length))
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   Species        n  mean</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 setosa        50  1.46</span>
<span class="co">#&gt; 2 versicolor    50  4.26</span>
<span class="co">#&gt; 3 virginica     50  5.55</span></code></pre></div>
<p>In Excel, the alternative to using a Pivot Table to summarize data for a group might be to use the <code>COUNTIF</code>, <code>SUMIF</code>, <code>AVERAGEIF</code> functions. These functions perform the same summary methods as mentioned above, but only on rows that meet some criteria. This is better represented in an R pipeline by using the <code>filter()</code> function to only select the observations that meet your criteria and then summarizing. In the example below we remove X observations and then calculate Y.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> &#39;setosa&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dt">mean=</span><span class="kw">mean</span>(Petal.Length))
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;       n  mean</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1    50  1.46</span></code></pre></div>
<p>In Excel you would implement this as a formula <code>AVERAGEIF(E2:E150, &quot;setosa&quot;, A2:A150)</code>. To reiterate, in R filtering just means that you remove any rows from a dataset that meet a certain criteria. This is helpful in a pipeline because it will remove the observations while performing that pipeline calculation without removing them from the original dataset you placed at the top of the pipeline. The symbols for doing comparisons, also called “logical operators”, are pretty much the same in Excel as they are in R. One key difference is that if you are checking whether two things are equal to each other in R, then you will need to use double equal signs (<code>A2==B2</code>) rather than the single equals sign that Excel uses <code>A2=B2</code>. Below is a table that shows how these operators are different in R compared to Excel</p>
<p>[INSERT TABLE HERE]</p>
<p>In the example below we show multiple of these operators in action to show how they can be used together to select a very small subset of observations from a data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(iris) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> &#39;setosa&#39;</span>,
         <span class="op">!</span>(Petal.Length <span class="op">==</span><span class="st"> </span><span class="fl">1.4</span> <span class="op">|</span><span class="st"> </span>Petal.Length <span class="op">==</span><span class="st"> </span><span class="fl">1.5</span>),
         Petal.Width <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;       n</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1     1</span></code></pre></div>
</div>
<div id="spread-and-gather" class="section level2">
<h2><span class="header-section-number">4.6</span> Spread and Gather</h2>
<p>One particular type of transformation is moving the data between a “long” format and a “wide” format. In the wide format each metric might be in its own column. If you have 20 metrics then the dataset will have at least 20 columns and it starts to become wider than it is long.</p>
<hr />
<p>FIGURE OUT AN EXAMPLE THAT IS REALLY REPRESENTATIVE OF THIS [INCLUDE LONG EXAMPLE]</p>
<hr />
<p>The long format is usually more preferable because functions like <code>filter()</code>, <code>group_by()</code>, and <code>summarize()</code> can operate quickly across rows rather than columns. In addition, the long format is more compatible with the <code>ggplot()</code> plotting function to specify multiple series, colors, and facets.</p>
<hr />
<p>SHOULD WE SHOW AN EXAMPLE OF GGPLOT HERE? OTHER IDEAS/REASONS</p>
<hr />
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">4.7</span> Functions</h2>
<p>In some cases</p>
</div>
<div id="putting-it-all-together" class="section level2">
<h2><span class="header-section-number">4.8</span> Putting it all together</h2>
<p>In this section we will show an example that utilizes many of the different methods described in this chapter so that readers can have a complete example</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataviz.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="datastructures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jeffboichuk/r4ma/edit/master/04-datatransformation.Rmd",
"text": "Edit"
},
"download": ["r4ma.pdf", "r4ma.epub", "r4ma.mobi"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
