<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R for Marketing Analytics</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="R for Marketing Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jeffboichuk.github.io/r4ma" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="jeffboichuk/r4ma" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Marketing Analytics" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Jeffrey Boichuk">
<meta name="author" content="Steven Mortimer">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="datatransformation.html">
<link rel="next" href="measures.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Marketing Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="marketing.html"><a href="marketing.html"><i class="fa fa-check"></i><b>1</b> What is Marketing?</a></li>
<li class="chapter" data-level="2" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>2</b> Tools at your Disposal</a><ul>
<li class="chapter" data-level="2.1" data-path="tools.html"><a href="tools.html#data"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="tools.html"><a href="tools.html#software"><i class="fa fa-check"></i><b>2.2</b> Software</a></li>
<li class="chapter" data-level="2.3" data-path="tools.html"><a href="tools.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.3</b> Getting Started with R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>3</b> Data Visualizations</a><ul>
<li class="chapter" data-level="3.1" data-path="dataviz.html"><a href="dataviz.html#creating-a-canvas"><i class="fa fa-check"></i><b>3.1</b> Creating a Canvas</a></li>
<li class="chapter" data-level="3.2" data-path="dataviz.html"><a href="dataviz.html#adding-layers-of-geoms"><i class="fa fa-check"></i><b>3.2</b> Adding Layers of Geoms</a></li>
<li class="chapter" data-level="3.3" data-path="dataviz.html"><a href="dataviz.html#adding-labels-axes-and-legends"><i class="fa fa-check"></i><b>3.3</b> Adding Labels, Axes, and Legends</a></li>
<li class="chapter" data-level="3.4" data-path="dataviz.html"><a href="dataviz.html#faceting-data-by-group"><i class="fa fa-check"></i><b>3.4</b> Faceting Data by Group</a></li>
<li class="chapter" data-level="3.5" data-path="dataviz.html"><a href="dataviz.html#chart-types"><i class="fa fa-check"></i><b>3.5</b> Chart Types</a></li>
<li class="chapter" data-level="3.6" data-path="dataviz.html"><a href="dataviz.html#advanced-plotting"><i class="fa fa-check"></i><b>3.6</b> Advanced Plotting</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datatransformation.html"><a href="datatransformation.html"><i class="fa fa-check"></i><b>4</b> Preparing and Transforming Data</a><ul>
<li class="chapter" data-level="4.1" data-path="datatransformation.html"><a href="datatransformation.html#data-pipelines"><i class="fa fa-check"></i><b>4.1</b> Data Pipelines</a></li>
<li class="chapter" data-level="4.2" data-path="datatransformation.html"><a href="datatransformation.html#selecting"><i class="fa fa-check"></i><b>4.2</b> Selecting</a></li>
<li class="chapter" data-level="4.3" data-path="datatransformation.html"><a href="datatransformation.html#mutating"><i class="fa fa-check"></i><b>4.3</b> Mutating</a></li>
<li class="chapter" data-level="4.4" data-path="datatransformation.html"><a href="datatransformation.html#grouped-mutates"><i class="fa fa-check"></i><b>4.4</b> Grouped Mutates</a></li>
<li class="chapter" data-level="4.5" data-path="datatransformation.html"><a href="datatransformation.html#summarizing"><i class="fa fa-check"></i><b>4.5</b> Summarizing</a></li>
<li class="chapter" data-level="4.6" data-path="datatransformation.html"><a href="datatransformation.html#spread-and-gather"><i class="fa fa-check"></i><b>4.6</b> Spread and Gather</a></li>
<li class="chapter" data-level="4.7" data-path="datatransformation.html"><a href="datatransformation.html#functions"><i class="fa fa-check"></i><b>4.7</b> Functions</a></li>
<li class="chapter" data-level="4.8" data-path="datatransformation.html"><a href="datatransformation.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.8</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="relational.html"><a href="relational.html"><i class="fa fa-check"></i><b>5</b> Relational Data</a><ul>
<li class="chapter" data-level="5.1" data-path="relational.html"><a href="relational.html#tidy-principles"><i class="fa fa-check"></i><b>5.1</b> Tidy Principles</a></li>
<li class="chapter" data-level="5.2" data-path="relational.html"><a href="relational.html#relational-data-structures"><i class="fa fa-check"></i><b>5.2</b> Relational Data Structures</a></li>
<li class="chapter" data-level="5.3" data-path="relational.html"><a href="relational.html#joins"><i class="fa fa-check"></i><b>5.3</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>6</b> Measures in Marketing</a><ul>
<li class="chapter" data-level="6.1" data-path="measures.html"><a href="measures.html#net-promoter-score"><i class="fa fa-check"></i><b>6.1</b> Net Promoter Score</a></li>
<li class="chapter" data-level="6.2" data-path="measures.html"><a href="measures.html#customer-lifetime-value"><i class="fa fa-check"></i><b>6.2</b> Customer Lifetime Value</a></li>
<li class="chapter" data-level="6.3" data-path="measures.html"><a href="measures.html#customer-satisfactioncustomer-delight"><i class="fa fa-check"></i><b>6.3</b> Customer Satisfaction/Customer Delight</a></li>
<li class="chapter" data-level="6.4" data-path="measures.html"><a href="measures.html#others-consult-ama-dictionary-for-more"><i class="fa fa-check"></i><b>6.4</b> Others? Consult AMA dictionary for more?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fieldexp.html"><a href="fieldexp.html"><i class="fa fa-check"></i><b>7</b> Conducting Marketing Field Experiment</a></li>
<li class="chapter" data-level="8" data-path="mix.html"><a href="mix.html"><i class="fa fa-check"></i><b>8</b> Understanding Marketing Mix</a></li>
<li class="chapter" data-level="9" data-path="trade.html"><a href="trade.html"><i class="fa fa-check"></i><b>9</b> Pricing and Merchandising</a></li>
<li class="chapter" data-level="10" data-path="machinelearning.html"><a href="machinelearning.html"><i class="fa fa-check"></i><b>10</b> Machine Learning in Marketing</a></li>
<li class="chapter" data-level="11" data-path="action.html"><a href="action.html"><i class="fa fa-check"></i><b>11</b> Moving from Data to Action</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Marketing Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="relational" class="section level1">
<h1><span class="header-section-number">5</span> Relational Data</h1>
<div id="tidy-principles" class="section level2">
<h2><span class="header-section-number">5.1</span> Tidy Principles</h2>
<p>[INSERT QUIP ABOUT TIDY DATA OR QUOTE]</p>
<p>In Chapter 2 when we introduced the R programming language as our preferred tool for marketing analytics we discussed the concept of “tidy” data.</p>
<p>More in depth about tidy principles</p>
<p>DESCRIBE WHAT IS A TIBBLE VS DATAFRAME?</p>
<p>How to store the data (what is a row and what is a column)</p>
</div>
<div id="relational-data-structures" class="section level2">
<h2><span class="header-section-number">5.2</span> Relational Data Structures</h2>
<p>In programming there is a matra of “Don’t repeat yourself” (DRY). It is a principle instilled in software developers because unnecessary repetition makes code less efficient, requires additional time to maintain, and can quickly become out of sync. In code, this means creating functions or classes. In databases, this is usually done through data normalization. The degree of data normalization is the extent to which the data is replicated in multiple places within a database. Highly normalized means that a single data point only appears in one place. In contrast, a highly denormalized dataset means that a single data point may appear in multiple places. For example, …</p>
<p>[PROVIDE AN EXAMPLE]</p>
<p>Databases use “keys” in order to keep track of related data points. The word “key” simply refers to values in one or more columns that identify each observation. In the example above we had the column XYZ was the key. In both tables this column existed and referred to the same observation. When working with real-world data it is important to understand how keys are represented in your dataset. There are names for two different types of keys that work together:</p>
<ol style="list-style-type: decimal">
<li>Primary key</li>
<li>Foreign key</li>
</ol>
<p>A primary key is one or more columns in a dataset that are always unique and non-missing for each row. Database architects can put explicit constraints on database tables so that duplicates are never entered into the data, even by mistake. This is a good practice for preserving data integrity. In the example above, the primary key is …</p>
<p>A foreign key is</p>
<p>A discussion of keys is available in Chapter 13 Section 3 of <em>R for Data Science</em> <span class="citation">(Hadley Wickham <a href="#ref-wickham2017">2017</a>)</span></p>
<p>ER diagram</p>
<p>Revisit spread, gather conversation with normalization backdrop??</p>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">5.3</span> Joins</h2>
<p>If database architects “normalize” a database by creating multiple tables that reference each other, then we need a way to bring the data back together from each of these sources. The process of combining columns from two or more tables is called a “join”. “Joining” tables may also be described as “merging”. These phrases usually mean the same thing. The tricky part about joining datasets is understanding how observations in each set should be matched and how to handle instances where the data is missing from one of the tables. One of the most effective ways to learn the behavior of different joins is to use venn diagrams. Below is a comprehensive outline of join operations. You will notice that depending on the type of join certain records will be retained. For example, the <code>inner_join()</code> function will only retain records if they both exist in the dataset.</p>
<p>[INSERT IMAGE HERE]</p>
<p>You will also notice in the join reference above how the observations are matched. Typically, you will choose one column and whereever there is a match between the datasets, then the rows will be combined having now columns from both datasets together for the same observation. The one or more columns used to match records is typically called the join “key”.</p>
<p>Consider a simple example where we have one dataset with three columns, the first is a record ID column and a second dataset with 2 columns, its first column is also a record ID column. We will assume the majority of records should have matching IDs between the two datasets. If we would like to “join” the second dataset into the first, then we should use the <code>left_join()</code> function. This function takes the first dataset provided, keeping all of its rows regardless of whether a matching record is found in the second dataset.</p>
<p>All of the columns in the second dataset are now added to the first dataset. In this example, that means only one additional column. The ID column is not duplicated after the merge because that information is reflected in the ID column from the first dataset. For readers with knowledge of SQL programming, the join functions in R perform exactly as their counterparts in SQL. For readers with knowledge of Excel this is akin to using the <code>VLOOKUP</code> function or a combination of <code>INDEX-MATCH</code> to pull records from another dataset.</p>
<hr />
<p>SHOULD WE EXPLICITLY SHOW THE TRANSLATION FROM VLOOKUP TO LEFT_JOIN()? OR INDEX-MATCH? ***</p>
<p>As depicted in the joins reference diagram there are different join types for returning records from both datasets, all from one dataset, or only the overalapping records. For example, the <code>outer_join()</code> function combines the rows that match on the join key(s) and retains all of the unmatched rows from each dataset. This is also sometimes referred to as a “full join” since it retains the full set of records from both datasets.</p>
<p>One join function that is unique is the <code>anti_join()</code> function. This join returns only the rows that are not matched in the second dataset. This is particularly useful for diagnosing what is not matching. If you think about its behavior, it should, together with the <code>inner_join()</code> function span all the records in the first dataset you provide. This is because either the records are matched via <code>inner_join()</code> or they are not matched and identifed via <code>anti_join()</code>. Below is an example which highlights that 95% of records are matched between the two datasets. The remaining 5% are returned via the <code>anti_join()</code> function for us to further inspect.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-wickham2017">
<p>Hadley Wickham, Garrett Grolemund. 2017. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. 1st ed. Sebastopol, California: O’Reilly Media, Incorporated. <a href="https://r4ds.had.co.nz" class="uri">https://r4ds.had.co.nz</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datatransformation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="measures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jeffboichuk/r4ma/edit/master/05-relational.Rmd",
"text": "Edit"
},
"download": ["r4ma.pdf", "r4ma.epub", "r4ma.mobi"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
